<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>酒店日期选择日历</title>
<style>
  :root{
    --bg:#0b1020; --card:#121833; --muted:#8ea0c8; --text:#eaf0ff;
    --accent:#4ea1ff; --accent-2:#6cf; --sold:#ff6b6b; --ok:#9be380;
    --ring: rgba(78,161,255,.35);
  }
  *{box-sizing:border-box}
  body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    background:var(--bg); color:var(--text); margin:0; padding:0;
  }

  /* ===== Hero Header ===== */
  .hero{
    position:relative;
    width:100%;
    min-height:360px;
    background-color:#000;
    background-image:url('https://raw.githubusercontent.com/TommyTam2012/advance_app_web/main/HotelLogo.png');
    background-size:contain;
    background-repeat:no-repeat;
    background-position:center;
    display:flex; align-items:flex-end; justify-content:center;
  }
  .hero-overlay{
    position:absolute; inset:0;
    background:linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.65));
  }
  .hero-inner{
    position:relative; z-index:1;
    text-align:center;
    padding:20px;
    margin-bottom:20px;
  }
  .brand h1{ margin:0; font-size:28px; letter-spacing:.04em; color:#fff; }
  .brand p{ margin:6px 0 0; color:var(--muted); font-size:15px; }

  /* ===== Page Wrap ===== */
  .wrap{max-width:980px; margin:0 auto; padding:24px;}

  .topbar,.controls{display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end; margin-bottom:16px}
  .field{
    flex:1 1 220px; background:var(--card); border-radius:14px; padding:10px 14px;
    display:flex; align-items:center; gap:10px; border:1px solid transparent
  }
  .field:focus-within{border-color:var(--accent); box-shadow:0 0 0 6px var(--ring)}
  .field label{font-size:12px; color:var(--muted); display:block}
  .field input,.field select{background:transparent; border:0; color:var(--text); font-size:15px; width:100%}
  .btn{background:var(--accent); color:#021024; border:0; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700}
  .btn[disabled]{opacity:.45; cursor:not-allowed}
  .btn.secondary{ background:#0e1533; color:var(--text); border:1px solid rgba(255,255,255,.12); }
  .calendar{background:var(--card); border-radius:18px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .cal-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px}
  .nav-btn{background:#0e1533; border:0; color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer}
  .months{display:grid; grid-template-columns:1fr 1fr; gap:16px}
  .month{padding:10px 12px; background:#0f1635; border-radius:14px; border:1px solid rgba(255,255,255,.06)}
  .month h4{margin:0 0 8px; font-weight:700}
  .grid{display:grid; grid-template-columns:repeat(7,1fr); gap:6px}
  .dow{font-size:12px; color:var(--muted); text-align:center; padding:6px 0}
  .cell{
    position:relative; min-height:64px; border-radius:12px; background:rgba(255,255,255,.02);
    display:flex; flex-direction:column; padding:6px; cursor:pointer; transition:transform .08s
  }
  .cell:hover{transform:translateY(-1px)}
  .cell.disabled{opacity:.32; pointer-events:none}
  .cell .d{font-weight:700; font-size:14px}
  .cell .p{font-size:12px; margin-top:auto}
  .cell .a{font-size:11px; color:var(--muted)}
  .cell.sold{background:rgba(255,107,107,.08)}
  .cell.sold .a{color:var(--sold)}
  .in-range{background:linear-gradient(180deg, rgba(78,161,255,.18), rgba(78,161,255,.09))}
  .checkin,.checkout{outline:2px solid var(--accent-2)}
  .legend{display:flex; gap:14px; align-items:center; color:var(--muted); font-size:12px; margin-top:10px}
  .dot{width:10px; height:10px; border-radius:2px; display:inline-block; margin-right:6px}
  .dot-ok{background:linear-gradient(180deg, rgba(155,227,128,.5), rgba(155,227,128,.15))}
  .dot-sold{background:rgba(255,107,107,.4)}
  .dot-range{background:linear-gradient(180deg, rgba(78,161,255,.35), rgba(78,161,255,.15))}
  .notice{margin-top:16px; color:var(--muted); font-size:12px}
  .muted{color:var(--muted); font-size:12px}
  .toast{margin-top:10px; padding:10px 12px; border-radius:10px; background:#0e1533; color:var(--text); display:none}
  @media (max-width:820px){ .months{grid-template-columns:1fr} }

  /* === New Dropdown Styling === */
  select {
    background-color: #1a1a1a;   /* dark background */
    color: #ffffff;              /* white text */
    border: 1px solid #4ea1ff;   /* blue border to match theme */
    border-radius: 8px;
    padding: 8px;
  }
  select option {
    background-color: #1a1a1a;   /* dark background for options */
    color: #ffffff;              /* white text */
  }
</style>
</head>
<body>

  <!-- Header / Hero -->
  <header class="hero" role="banner" aria-label="Tommy Sir's 深圳度假村">
    <div class="hero-overlay"></div>
    <div class="hero-inner">
      <div class="brand">
        <h1>Tommy Sir's 深圳度假村</h1>
        <p>AI禮賓服務 • 多國語言服務 • 全天候</p>
      </div>
    </div>
  </header>

  <div class="wrap">
    <!-- 顶部控件 -->
    <div class="topbar">
      <div class="field" style="max-width:220px">
        <div>
          <label for="roomType">房型</label>
          <select id="roomType" aria-label="选择房型">
            <option value="">加载中…</option>
          </select>
        </div>
      </div>

      <div class="field">
        <div>
          <label for="guestName">客人姓名</label>
          <input id="guestName" placeholder="请输入姓名" />
        </div>
      </div>

      <div class="field">
        <div>
          <label for="guestEmail">电子邮箱（可选）</label>
          <input id="guestEmail" type="email" placeholder="you@example.com" />
        </div>
      </div>

      <div class="field" style="max-width:160px">
        <div>
          <label for="qty">房间数量</label>
          <select id="qty" aria-label="选择房间数量">
            <option>1</option><option>2</option><option>3</option><option>4</option>
            <option>5</option><option>6</option><option>7</option><option>8</option>
            <option>9</option><option>10</option>
          </select>
        </div>
      </div>

      <button id="bookBtn" class="btn" disabled>预订所选日期</button>
      <button id="resetBtn" class="btn secondary" type="button" title="重选日期（不刷新页面）">重选日期</button>
    </div>

    <!-- 选择的日期 -->
    <div class="controls">
      <div class="field">
        <div>
          <label for="checkinInput">入住日期</label>
          <input id="checkinInput" placeholder="YYYY-MM-DD" />
        </div>
      </div>
      <div class="field">
        <div>
          <label for="checkoutInput">退房日期</label>
          <input id="checkoutInput" placeholder="YYYY-MM-DD" />
        </div>
      </div>
      <div class="muted" id="nightsInfo"></div>
    </div>

    <!-- 日历 -->
    <div class="calendar">
      <div class="cal-header">
        <button class="nav-btn" id="prevBtn" aria-label="上一月">◀</button>
        <div style="opacity:.85;font-size:14px">请选择您的入住日期</div>
        <button class="nav-btn" id="nextBtn" aria-label="下一月">▶</button>
      </div>

      <div class="months" id="months"></div>

      <div class="legend">
        <span><span class="dot dot-range"></span>已选区间</span>
        <span><span class="dot dot-ok"></span>可订</span>
        <span><span class="dot dot-sold"></span>售罄 / 不可订</span>
      </div>
      <div class="notice">提示：可直接输入日期，或先点击入住日（Check-in），再点击退房日（Check-out）。`/availability` 的结束日期为“包含”；下单时退房为“非包含”。</div>
      <div class="toast" id="toast"></div>
    </div>
  </div>

  <!-- 日历逻辑 -->
  <script src="/static/calendar.js" defer></script>

  <!-- NEW: 动态加载房型下拉菜单（从 /room_types） -->
  <script>
    (async function populateRoomTypes(){
      const sel = document.getElementById('roomType');
      if(!sel) return;
      try{
        const res = await fetch(window.location.origin + '/room_types');
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const list = await res.json(); // 期望: [{id, name}]
        if(!Array.isArray(list) || list.length === 0){
          sel.innerHTML = '<option value="">暂无房型</option>';
          return;
        }
        sel.innerHTML = list.map(rt => `<option value="${rt.id}">${rt.name}</option>`).join('');
      }catch(err){
        console.error('载入 /room_types 失败:', err);
        sel.innerHTML = '<option value="">载入失败</option>';
      }
    })();
  </script>
</body>
</html>
