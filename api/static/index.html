<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hotel Date Range Calendar</title>
<style>
  :root{
    --bg:#0b1020; --card:#121833; --muted:#8ea0c8; --text:#eaf0ff;
    --accent:#4ea1ff; --accent-2:#6cf; --sold:#ff6b6b; --ok:#9be380;
    --ring: rgba(78,161,255,.35);
  }
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
       background:var(--bg); color:var(--text); margin:0; padding:24px;}
  .wrap{max-width:980px; margin:0 auto;}
  .controls{display:flex; gap:12px; flex-wrap:wrap; margin-bottom:16px}
  .field{flex:1 1 220px; background:var(--card); border-radius:14px; padding:10px 14px;
         display:flex; align-items:center; gap:10px; border:1px solid transparent}
  .field:focus-within{outline:none; border-color:var(--accent); box-shadow:0 0 0 6px var(--ring)}
  .field label{font-size:12px; color:var(--muted); display:block}
  .field input{background:transparent; border:0; color:var(--text); font-size:15px; width:100%}
  .calendar{background:var(--card); border-radius:18px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .cal-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px}
  .nav-btn{background:#0e1533; border:0; color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer}
  .months{display:grid; grid-template-columns:1fr 1fr; gap:16px}
  .month{padding:10px 12px; background:#0f1635; border-radius:14px; border:1px solid rgba(255,255,255,.06)}
  .month h4{margin:0 0 8px; font-weight:700}
  .grid{display:grid; grid-template-columns:repeat(7,1fr); gap:6px}
  .dow{font-size:12px; color:var(--muted); text-align:center; padding:6px 0}
  .cell{position:relative; min-height:64px; border-radius:12px; background:rgba(255,255,255,.02);
        display:flex; flex-direction:column; padding:6px; cursor:pointer; transition:transform .08s}
  .cell:hover{transform:translateY(-1px)}
  .cell.disabled{opacity:.32; pointer-events:none}
  .cell .d{font-weight:700; font-size:14px}
  .cell .p{font-size:12px; margin-top:auto}
  .cell .a{font-size:11px; color:var(--muted)}
  .cell.sold{background:rgba(255,107,107,.08)}
  .cell.sold .a{color:var(--sold)}
  .in-range{background:linear-gradient(180deg, rgba(78,161,255,.18), rgba(78,161,255,.09))}
  .checkin, .checkout{outline:2px solid var(--accent-2)}
  .legend{display:flex; gap:14px; align-items:center; color:var(--muted); font-size:12px; margin-top:10px}
  .dot{width:10px; height:10px; border-radius:2px; display:inline-block; margin-right:6px}
  .dot-ok{background:linear-gradient(180deg, rgba(155,227,128,.5), rgba(155,227,128,.15))}
  .dot-sold{background:rgba(255,107,107,.4)}
  .dot-range{background:linear-gradient(180deg, rgba(78,161,255,.35), rgba(78,161,255,.15))}
  .notice{margin-top:16px; color:var(--muted); font-size:12px}
  @media (max-width:820px){ .months{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="wrap">
  <div class="controls">
    <div class="field">
      <div>
        <label>Check-in</label>
        <input id="checkinInput" placeholder="Select date" readonly />
      </div>
    </div>
    <div class="field">
      <div>
        <label>Check-out</label>
        <input id="checkoutInput" placeholder="Select date" readonly />
      </div>
    </div>
  </div>

  <div class="calendar">
    <div class="cal-header">
      <button class="nav-btn" id="prevBtn" aria-label="Previous month">◀</button>
      <div style="opacity:.75;font-size:14px">Select your stay dates</div>
      <button class="nav-btn" id="nextBtn" aria-label="Next month">▶</button>
    </div>

    <div class="months" id="months"></div>

    <div class="legend">
      <span><span class="dot dot-range"></span>Selected range</span>
      <span><span class="dot dot-ok"></span>Available</span>
      <span><span class="dot dot-sold"></span>Sold out / Blackout</span>
    </div>
    <div class="notice">Tip: click a start date (check-in), then click your end date (check-out). Prices are per night.</div>
  </div>
</div>

<script>
/* ============ CONFIG ============ */
const MIN_NIGHTS = 1;               // set to 2, 3, etc. if needed
const MAX_NIGHTS = 30;              // optional cap
const BLACKOUT = new Set([          // YYYY-MM-DD strings
  // "2025-12-31"
]);

/* Mock availability & price.
   Replace fetchAvailability() with your backend API:
   GET /api/availability?room_type=Deluxe&from=YYYY-MM-01&to=YYYY-MM-31
   -> return { "2025-09-18": {price: 899, left: 3}, ... }  */
async function fetchAvailability(year, month){ // month: 0-11
  // demo: generate rolling data
  const data = {};
  const daysInMonth = new Date(year, month+1, 0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const dt = new Date(year, month, d);
    const key = fmt(dt);
    const base = 680 + ((month+1)*7) + (d%5)*35;
    // Simple pattern: weekends pricier, occasional sold-out
    const isWeekend = [0,6].includes(dt.getDay());
    const left = (d%9===0) ? 0 : (isWeekend ? 2 : 5);
    data[key] = { price: base + (isWeekend?90:0), left };
  }
  // sprinkle some blackout
  [...BLACKOUT].forEach(k => { if (k.startsWith(`${year}-${pad(month+1)}`)) data[k] = { price:null, left:0 }; });
  return data;
}

/* ============ STATE ============ */
let anchorMonth = new Date(); // left month
anchorMonth.setDate(1);
let checkIn = null, checkOut = null, hoverDate = null;
let availabilityCache = {}; // { "YYYY-MM": { "YYYY-MM-DD": {price,left}, ... } }

/* ============ UTILITIES ============ */
const pad = n => String(n).padStart(2,'0');
const fmt = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
const todayStr = fmt(new Date());
function addDays(d, n){ const x = new Date(d); x.setDate(x.getDate()+n); return x; }
function within(a, b, c){ return a<=b && b<=c; }

/* ============ RENDER ============ */
async function ensureMonthData(year, month){
  const key = `${year}-${pad(month+1)}`;
  if (!availabilityCache[key]) {
    availabilityCache[key] = await fetchAvailability(year, month);
  }
  return availabilityCache[key];
}
function monthTitle(year, month){
  const dt = new Date(year, month, 1);
  return dt.toLocaleString(undefined, { month: 'long', year:'numeric' });
}
function weekdayHeaders(){
  const base = new Date(2025, 0, 5); // Monday
  return Array.from({length:7}, (_,i)=> new Date(base.getTime() + i*86400000)
    .toLocaleString(undefined,{weekday:'short'}));
}

async function render(){
  const monthsEl = document.getElementById('months');
  monthsEl.innerHTML = '';

  for(let m=0; m<2; m++){
    const dt = new Date(anchorMonth.getFullYear(), anchorMonth.getMonth()+m, 1);
    const year = dt.getFullYear(), month = dt.getMonth();
    const data = await ensureMonthData(year, month);

    const firstDow = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();

    const monthEl = document.createElement('div');
    monthEl.className = 'month';

    const h4 = document.createElement('h4');
    h4.textContent = monthTitle(year, month);
    monthEl.appendChild(h4);

    const grid = document.createElement('div');
    grid.className = 'grid';

    // DOW row
    weekdayHeaders().forEach(dow=>{
      const el = document.createElement('div');
      el.className='dow';
      el.textContent=dow;
      grid.appendChild(el);
    });

    // leading blanks
    for(let i=0; i<firstDow; i++){
      const blank = document.createElement('div');
      blank.className='cell disabled';
      grid.appendChild(blank);
    }

    for(let d=1; d<=daysInMonth; d++){
      const dateObj = new Date(year, month, d);
      const key = fmt(dateObj);
      const info = data[key] || {price:null, left:0};

      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.date = key;

      // Disable past, sold, blackout
      const isPast = key < todayStr;
      const isBlackout = BLACKOUT.has(key);
      const isSold = (info.left ?? 0) <= 0 || isBlackout;

      if (isPast || isSold){
        cell.classList.add('disabled');
        if (isSold) cell.classList.add('sold');
      }

      const dEl = document.createElement('div');
      dEl.className='d';
      dEl.textContent=d;
      cell.appendChild(dEl);

      const pEl = document.createElement('div');
      pEl.className='p';
      pEl.textContent = (info.price!=null) ? `$${info.price}` : (isBlackout ? 'Blackout' : '—');
      cell.appendChild(pEl);

      const aEl = document.createElement('div');
      aEl.className='a';
      aEl.textContent = isBlackout ? 'Unavailable' : (isSold ? 'Sold out' : `${info.left} left`);
      cell.appendChild(aEl);

      // Selection visuals
      const ci = checkIn ? fmt(checkIn) : null;
      const co = checkOut ? fmt(checkOut) : null;
      const hov = hoverDate ? fmt(hoverDate) : null;

      if (ci && key===ci) cell.classList.add('checkin');
      if (co && key===co) cell.classList.add('checkout');

      // hover / in-range
      const left = ci && !co && hov && (key >= ci && key <= hov);
      const fixed = ci && co && (key >= ci && key <= co);
      if (left || fixed){ cell.classList.add('in-range'); }

      // Handlers
      cell.addEventListener('mouseenter', () => {
        if (checkIn && !checkOut && !isPast && !isSold){
          hoverDate = dateObj >= checkIn ? dateObj : null;
          highlight();
        }
      });
      cell.addEventListener('mouseleave', () => {
        if (checkIn && !checkOut){ hoverDate = null; highlight(); }
      });

      cell.addEventListener('click', () => onPick(dateObj, isPast || isSold));

      grid.appendChild(cell);
    }

    monthEl.appendChild(grid);
    monthsEl.appendChild(monthEl);
  }
  updateInputs();
  managePrevNext();
}

function highlight(){
  // re-render quickly (cheap for 2 months)
  render();
}

function nightsBetween(a,b){
  return Math.max(0, Math.round((b - a) / 86400000));
}

function onPick(dateObj, disabled){
  if (disabled) return;

  if (!checkIn || (checkIn && checkOut)){
    // start new range
    checkIn = dateObj; checkOut = null; hoverDate = null;
    highlight();
    return;
  }
  // picking check-out
  if (dateObj <= checkIn){
    // restart with new check-in
    checkIn = dateObj; checkOut = null; hoverDate = null;
    highlight();
    return;
  }
  const stay = nightsBetween(checkIn, dateObj);
  if (stay < MIN_NIGHTS || stay > MAX_NIGHTS){
    // optional toast
    alert(`Please choose between ${MIN_NIGHTS} and ${MAX_NIGHTS} nights.`);
    return;
  }
  // Validate that all days in the range are available
  const valid = rangeAllAvailable(checkIn, dateObj);
  if (!valid){
    alert("Selected range includes sold-out/blackout dates. Please try a different range.");
    return;
  }
  checkOut = dateObj; hoverDate = null; highlight();
  onRangePicked({ checkIn, checkOut });
}

function rangeAllAvailable(a, b){
  let d = new Date(a);
  while (d < b){
    const key = fmt(d);
    const ym = key.slice(0,7);
    const info = (availabilityCache[ym] && availabilityCache[ym][key]) || {left:0};
    if (BLACKOUT.has(key) || (info.left ?? 0) <= 0) return false;
    d = addDays(d, 1);
  }
  return true;
}

function updateInputs(){
  const ci = document.getElementById('checkinInput');
  const co = document.getElementById('checkoutInput');
  ci.value = checkIn ? checkIn.toLocaleDateString() : '';
  co.value = checkOut ? checkOut.toLocaleDateString() : '';
}

function managePrevNext(){
  const prev = document.getElementById('prevBtn');
  const minMonth = new Date(); minMonth.setDate(1);
  const isAtMin = anchorMonth <= minMonth;
  prev.disabled = isAtMin;
  prev.style.opacity = isAtMin ? .35 : 1;
}

/* Callback: connect to your form/booking flow here */
function onRangePicked({ checkIn, checkOut }){
  // Example: emit a CustomEvent
  document.dispatchEvent(new CustomEvent('dates-picked', {
    detail: { checkIn: fmt(checkIn), checkOut: fmt(checkOut) }
  }));
  // Or update hidden fields / auto-advance UI
  console.log('Picked range:', fmt(checkIn), '→', fmt(checkOut));
}

/* Nav buttons */
document.getElementById('prevBtn').addEventListener('click', () => {
  const next = new Date(anchorMonth);
  next.setMonth(next.getMonth()-1);
  // prevent navigating before current month
  const min = new Date(); min.setDate(1);
  if (next < min) return;
  anchorMonth = next; render();
});
document.getElementById('nextBtn').addEventListener('click', () => {
  const next = new Date(anchorMonth);
  next.setMonth(next.getMonth()+1);
  anchorMonth = next; render();
});

/* Initialize */
render();

/* Example: listen to picked dates and fill your form */
document.addEventListener('dates-picked', (e)=>{
  // e.detail = { checkIn: "YYYY-MM-DD", checkOut: "YYYY-MM-DD" }
  // --- PLACE YOUR FORM WIRING HERE ---
  // document.querySelector('#checkinHidden').value = e.detail.checkIn;
  // document.querySelector('#checkoutHidden').value = e.detail.checkOut;
});
</script>
</body>
</html>
